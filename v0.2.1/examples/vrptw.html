<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vehicle Routing Problem with Time Windows &mdash; PyVRP 0.2.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Capacitated Vehicle Routing Problem" href="cvrp.html" />
    <link rel="prev" title="Benchmarks" href="../setup/benchmarks.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            PyVRP
          </a>
              <div class="version">
                0.2.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/introduction_to_hgs.html">A brief introduction to HGS for VRP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/installation.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/getting_help.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vehicle Routing Problem with Time Windows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Basic-example">Basic example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Read-and-plot-instance">Read and plot instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Configuring-Hybrid-Genetic-Search">Configuring Hybrid Genetic Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Solving-an-instance">Solving an instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plot-results">Plot results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Inspect-routes">Inspect routes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Solving-larger-instances">Solving larger instances</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Gehring-&amp;-Homberger-instance">Gehring &amp; Homberger instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ORTEC-instance-(from-the-EURO-Meets-NeurIPS-2022-Competition)">ORTEC instance (from the EURO Meets NeurIPS 2022 Competition)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cvrp.html">Capacitated Vehicle Routing Problem</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/pyvrp.html">PyVRP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/crossover.html">Crossover operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/diagnostics.html">Diagnostic results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/diversity.html">Diversity measures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/educate.html">Education</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plotting.html">Plotting tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/stop.html">Stopping criteria</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developing PyVRP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/benchmarking.html">Benchmarking</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyVRP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Vehicle Routing Problem with Time Windows</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/vrptw.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Vehicle-Routing-Problem-with-Time-Windows">
<h1>Vehicle Routing Problem with Time Windows<a class="headerlink" href="#Vehicle-Routing-Problem-with-Time-Windows" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>This notebook shows how to use the PyVRP library to solve the Vehicle Routing Problem with Time Windows (VRPTW).</p>
<p>A VRPTW instance is defined on a complete graph <span class="math notranslate nohighlight">\(G=(V,A)\)</span>, where <span class="math notranslate nohighlight">\(V\)</span> is the vertex set and <span class="math notranslate nohighlight">\(A\)</span> is the arc set. The vertex set <span class="math notranslate nohighlight">\(V\)</span> is partitioned into <span class="math notranslate nohighlight">\(V=\{0\} \cup V_c\)</span>, where <span class="math notranslate nohighlight">\(0\)</span> represents the depot and <span class="math notranslate nohighlight">\(V_c=\{1, \dots, n\}\)</span> denotes the set of <span class="math notranslate nohighlight">\(n\)</span> customers. Each arc <span class="math notranslate nohighlight">\((i, j) \in A\)</span> has a weight <span class="math notranslate nohighlight">\(d_{ij} \ge 0\)</span> that represents the travel distance from <span class="math notranslate nohighlight">\(i \in V\)</span> to <span class="math notranslate nohighlight">\(j \in V\)</span>, which need not to be symmetric and/or euclidean.
Each customer <span class="math notranslate nohighlight">\(i \in V_c\)</span> has a demand <span class="math notranslate nohighlight">\(q_{i} \ge 0\)</span>, a service time <span class="math notranslate nohighlight">\(s_{i} \ge 0\)</span> and a (hard) time window <span class="math notranslate nohighlight">\(\left[e_i, l_i\right]\)</span> that denotes the earliest and latest time that service can start. A vehicle is allowed to arrive at a customer location before the beginning of the time window, but it must wait for the window to open to start the delivery. Each vehicle must return to the depot before the end of the depot time window <span class="math notranslate nohighlight">\(H\)</span>. We assume that there is an
unlimited number of homogeneous vehicles available, each with maximum capacity <span class="math notranslate nohighlight">\(Q &gt; 0\)</span>.</p>
<p>A feasible solution to the VRPTW consists of a set of routes that all begin and end at the depot, such that each customer is visited exactly once, all customers are served within their time windows and none of the vehicles exceed their capacity. The objective is to find a feasible solution that minimizes the total distance.</p>
<p>In the following, we will show how to configure the Hybrid Genetic Search algorithm to solve three different VRPTW instances. Moreover, we demonstrate how to use plotting and diagnostics utilities from the PyVRP library to analyze the results.</p>
<section id="Basic-example">
<h2>Basic example<a class="headerlink" href="#Basic-example" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>We‚Äôll start with a basic example that loads an instance and solves it using a standard configuration. First, let‚Äôs import some necessary components.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">vrplib</span>

<span class="kn">from</span> <span class="nn">pyvrp</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GeneticAlgorithm</span><span class="p">,</span>
    <span class="n">GeneticAlgorithmParams</span><span class="p">,</span>
    <span class="n">Individual</span><span class="p">,</span>
    <span class="n">PenaltyManager</span><span class="p">,</span>
    <span class="n">Population</span><span class="p">,</span>
    <span class="n">PopulationParams</span><span class="p">,</span>
    <span class="n">ProblemData</span><span class="p">,</span>
    <span class="n">Result</span><span class="p">,</span>
    <span class="n">XorShift128</span><span class="p">,</span>
    <span class="n">diagnostics</span><span class="p">,</span>
    <span class="n">plotting</span><span class="p">,</span>
    <span class="n">read</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyvrp.crossover</span> <span class="kn">import</span> <span class="n">selective_route_exchange</span> <span class="k">as</span> <span class="n">srex</span>
<span class="kn">from</span> <span class="nn">pyvrp.diversity</span> <span class="kn">import</span> <span class="n">broken_pairs_distance</span> <span class="k">as</span> <span class="n">bpd</span>
<span class="kn">from</span> <span class="nn">pyvrp.educate</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">NODE_OPERATORS</span><span class="p">,</span>
    <span class="n">ROUTE_OPERATORS</span><span class="p">,</span>
    <span class="n">LocalSearch</span><span class="p">,</span>
    <span class="n">compute_neighbours</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyvrp.stop</span> <span class="kn">import</span> <span class="n">MaxIterations</span><span class="p">,</span> <span class="n">MaxRuntime</span><span class="p">,</span> <span class="n">StoppingCriterion</span>
</pre></div>
</div>
</div>
<section id="Read-and-plot-instance">
<h3>Read and plot instance<a class="headerlink" href="#Read-and-plot-instance" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>We will first load one of the classical Solomon instances. We use the function <code class="docutils literal notranslate"><span class="pre">pyvrp.read</span></code>, which reads the instance file and converts it to a <code class="docutils literal notranslate"><span class="pre">ProblemData</span></code> instance. We pass the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">instance_format='solomon'</span></code>: this parses the instance file as a Solomon formatted instance (as opposed to VRPLIB formatted instances),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">round_func='trunc1'</span></code>: this compute distances with 1 decimal precision, by multipliying all distances by 10 and converting to integers (i.e., following the <a class="reference external" href="http://dimacs.rutgers.edu/programs/challenge/vrp/">DIMACS VRP challenge</a> convention).</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">instance</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;data/RC208.vrp&quot;</span><span class="p">,</span> <span class="n">instance_format</span><span class="o">=</span><span class="s2">&quot;solomon&quot;</span><span class="p">,</span> <span class="n">round_func</span><span class="o">=</span><span class="s2">&quot;trunc1&quot;</span>
<span class="p">)</span>
<span class="n">instance_bks</span> <span class="o">=</span> <span class="n">vrplib</span><span class="o">.</span><span class="n">read_solution</span><span class="p">(</span><span class="s2">&quot;data/RC208.sol&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let‚Äôs plot the instance and see what we have. The function <code class="docutils literal notranslate"><span class="pre">plotting.plot_instance</span></code> will plot time windows, demands and coordinates, which should give us a good impression of what the instance looks like (note that these can also be plotted separately using the <code class="docutils literal notranslate"><span class="pre">plotting.plot_*</span></code> functions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_instance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_vrptw_6_0.png" src="../_images/examples_vrptw_6_0.png" />
</div>
</div>
</section>
<section id="Configuring-Hybrid-Genetic-Search">
<h3>Configuring Hybrid Genetic Search<a class="headerlink" href="#Configuring-Hybrid-Genetic-Search" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Now we will implement the <code class="docutils literal notranslate"><span class="pre">solve</span></code> function that sets up the necessary components of the Hybrid Genetic Search algorithm, which is a hybrid between a genetic algorithm and local search. The components include <code class="docutils literal notranslate"><span class="pre">Population</span></code>, <code class="docutils literal notranslate"><span class="pre">LocalSearch</span></code>, and the <code class="docutils literal notranslate"><span class="pre">PenaltyManager</span></code>. Then we will create the <code class="docutils literal notranslate"><span class="pre">GeneticAlgorithm</span></code> object and run it until our desired <code class="docutils literal notranslate"><span class="pre">StoppingCriterion</span></code> is met.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">solve</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">ProblemData</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">max_runtime</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">XorShift128</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">pen_manager</span> <span class="o">=</span> <span class="n">PenaltyManager</span><span class="p">()</span>
    <span class="n">pop_params</span> <span class="o">=</span> <span class="n">PopulationParams</span><span class="p">()</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">Population</span><span class="p">(</span><span class="n">bpd</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pop_params</span><span class="p">)</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">LocalSearch</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rng</span><span class="p">,</span> <span class="n">compute_neighbours</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">NODE_OPERATORS</span><span class="p">:</span>
        <span class="n">ls</span><span class="o">.</span><span class="n">add_node_operator</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">ROUTE_OPERATORS</span><span class="p">:</span>
        <span class="n">ls</span><span class="o">.</span><span class="n">add_route_operator</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="n">init</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Individual</span><span class="o">.</span><span class="n">make_random</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pop_params</span><span class="o">.</span><span class="n">min_pop_size</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">ga_params</span> <span class="o">=</span> <span class="n">GeneticAlgorithmParams</span><span class="p">(</span><span class="n">collect_statistics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">algo</span> <span class="o">=</span> <span class="n">GeneticAlgorithm</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">pen_manager</span><span class="p">,</span> <span class="n">rng</span><span class="p">,</span> <span class="n">pop</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">srex</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">ga_params</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">max_runtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">MaxRuntime</span><span class="p">(</span><span class="n">max_runtime</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">max_iterations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">MaxIterations</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Solving-an-instance">
<h3>Solving an instance<a class="headerlink" href="#Solving-an-instance" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Now let‚Äôs run the algorithm using our <code class="docutils literal notranslate"><span class="pre">solve</span></code> function and compare the result with the best known solution. To compute the cost for the solution, we need a <code class="docutils literal notranslate"><span class="pre">CostEvaluator</span></code> instance. We can get it from the penalty manager.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">report_gap</span><span class="p">(</span><span class="n">best_cost</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">bks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">objective</span> <span class="o">=</span> <span class="n">best_cost</span> <span class="o">/</span> <span class="n">scale_factor</span>
    <span class="n">bks_cost</span> <span class="o">=</span> <span class="n">bks</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">]</span>
    <span class="n">pct_diff</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">objective</span> <span class="o">-</span> <span class="n">bks_cost</span><span class="p">)</span> <span class="o">/</span> <span class="n">bks_cost</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found a solution with cost: </span><span class="si">{</span><span class="n">objective</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This is </span><span class="si">{</span><span class="n">pct_diff</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% worse than the best known&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;solution, which is </span><span class="si">{</span><span class="n">bks_cost</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>


<span class="n">cost_evaluator</span> <span class="o">=</span> <span class="n">PenaltyManager</span><span class="p">()</span><span class="o">.</span><span class="n">get_cost_evaluator</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_runtime</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">report_gap</span><span class="p">(</span><span class="n">cost_evaluator</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">best</span><span class="p">),</span> <span class="n">instance_bks</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found a solution with cost: 776.1.
This is 0.0% worse than the best known solution, which is 776.1.
</pre></div></div>
</div>
<p>We‚Äôve managed to find the best known solution in 5 seconds!</p>
</section>
<section id="Plot-results">
<h3>Plot results<a class="headerlink" href="#Plot-results" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> object (of type <code class="docutils literal notranslate"><span class="pre">Result</span></code>) contains useful statistics about the optimization since we set <code class="docutils literal notranslate"><span class="pre">collect_statistics=True</span></code> in <code class="docutils literal notranslate"><span class="pre">GeneticAlgorithmParams</span></code> (see the <code class="docutils literal notranslate"><span class="pre">solve</span></code> function). We can now plot these statistics as well as the final solution use <code class="docutils literal notranslate"><span class="pre">plotting.plot_result</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_result</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">ProblemData</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">plotting</span><span class="o">.</span><span class="n">plot_result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>


<span class="n">plot_result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_vrptw_14_0.png" src="../_images/examples_vrptw_14_0.png" />
</div>
</div>
</section>
<section id="Inspect-routes">
<h3>Inspect routes<a class="headerlink" href="#Inspect-routes" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>We can also inspect some statistics of the different routes, such as route distance and duration, number of stops and total demand, using <code class="docutils literal notranslate"><span class="pre">diagnostics.get_all_route_statistics</span></code>. Let‚Äôs verify that the cost of our solution is equal to the sum of the distances.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cost_evaluator</span> <span class="o">=</span> <span class="n">PenaltyManager</span><span class="p">()</span><span class="o">.</span><span class="n">get_cost_evaluator</span><span class="p">()</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">best</span>
<span class="n">route_stats</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">get_all_route_statistics</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
<span class="n">route_stats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">route_stats</span><span class="p">)</span>

<span class="c1"># Verify that cost is equal to total distance</span>
<span class="k">assert</span> <span class="n">route_stats_df</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">cost_evaluator</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">route_stats_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>distance</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>duration</th>
      <th>timewarp</th>
      <th>wait_time</th>
      <th>service_time</th>
      <th>num_stops</th>
      <th>total_demand</th>
      <th>fillrate</th>
      <th>is_feasible</th>
      <th>is_empty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2187</td>
      <td>0</td>
      <td>7043</td>
      <td>7043</td>
      <td>0</td>
      <td>2156</td>
      <td>2700</td>
      <td>27</td>
      <td>465</td>
      <td>0.465</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1983</td>
      <td>0</td>
      <td>6862</td>
      <td>6862</td>
      <td>0</td>
      <td>2479</td>
      <td>2400</td>
      <td>24</td>
      <td>381</td>
      <td>0.381</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1325</td>
      <td>0</td>
      <td>6016</td>
      <td>6016</td>
      <td>0</td>
      <td>2991</td>
      <td>1700</td>
      <td>17</td>
      <td>286</td>
      <td>0.286</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2266</td>
      <td>0</td>
      <td>7295</td>
      <td>7295</td>
      <td>0</td>
      <td>1829</td>
      <td>3200</td>
      <td>32</td>
      <td>592</td>
      <td>0.592</td>
      <td>True</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can inspect the routes in more detail using the <code class="docutils literal notranslate"><span class="pre">plotting.plot_route_schedule</span></code> function. This will plot distance on the x-axis, and time on the y-axis, separating actual travel/driving time from waiting and service time. The clients visited are plotted as grey vertical bars indicating their time windows. When a vehicle arrives too early at a customer, we can see a jump to the start of the time window in the main (earliest) time line. In some cases, there is slack in the route indicated by a
semi-transparent region on top of the earliest time line (see plot of Route 1). The grey background indicates the remaining load of the truck during the route, where the (right) y-axis ends at the vehicle capacity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_route_schedule</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">ProblemData</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

    <span class="n">routes</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">best</span><span class="o">.</span><span class="n">get_routes</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">route</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axarr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">routes</span><span class="p">)):</span>
        <span class="n">plotting</span><span class="o">.</span><span class="n">plot_route_schedule</span><span class="p">(</span>
            <span class="n">instance</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Route </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>


<span class="n">plot_route_schedule</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_vrptw_18_0.png" src="../_images/examples_vrptw_18_0.png" />
</div>
</div>
</section>
</section>
<section id="Solving-larger-instances">
<h2>Solving larger instances<a class="headerlink" href="#Solving-larger-instances" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="Gehring-&amp;-Homberger-instance">
<h3>Gehring &amp; Homberger instance<a class="headerlink" href="#Gehring-&-Homberger-instance" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Let‚Äôs try one of the largest Gehring &amp; Homberger instances (1000 customers), and plot the instance, results and some routes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">instance_gh</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;data/RC2_10_5.vrp&quot;</span><span class="p">,</span> <span class="n">instance_format</span><span class="o">=</span><span class="s2">&quot;solomon&quot;</span><span class="p">,</span> <span class="n">round_func</span><span class="o">=</span><span class="s2">&quot;trunc1&quot;</span>
<span class="p">)</span>
<span class="n">bks_gh</span> <span class="o">=</span> <span class="n">vrplib</span><span class="o">.</span><span class="n">read_solution</span><span class="p">(</span><span class="s2">&quot;data/RC2_10_5.sol&quot;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_instance</span><span class="p">(</span><span class="n">instance_gh</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

<span class="n">result_gh</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">instance_gh</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_runtime</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">cost_evaluator</span> <span class="o">=</span> <span class="n">PenaltyManager</span><span class="p">()</span><span class="o">.</span><span class="n">get_cost_evaluator</span><span class="p">()</span>
<span class="n">best_cost_gh</span> <span class="o">=</span> <span class="n">cost_evaluator</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">result_gh</span><span class="o">.</span><span class="n">best</span><span class="p">)</span>
<span class="n">report_gap</span><span class="p">(</span><span class="n">best_cost_gh</span><span class="p">,</span> <span class="n">bks_gh</span><span class="p">)</span>
<span class="n">plot_result</span><span class="p">(</span><span class="n">result_gh</span><span class="p">,</span> <span class="n">instance_gh</span><span class="p">)</span>
<span class="n">plot_route_schedule</span><span class="p">(</span><span class="n">result_gh</span><span class="p">,</span> <span class="n">instance_gh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found a solution with cost: 26548.6.
This is 2.9% worse than the best known solution, which is 25797.5.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_vrptw_21_1.png" src="../_images/examples_vrptw_21_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_vrptw_21_2.png" src="../_images/examples_vrptw_21_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_vrptw_21_3.png" src="../_images/examples_vrptw_21_3.png" />
</div>
</div>
</section>
<section id="ORTEC-instance-(from-the-EURO-Meets-NeurIPS-2022-Competition)">
<h3>ORTEC instance (from the EURO Meets NeurIPS 2022 Competition)<a class="headerlink" href="#ORTEC-instance-(from-the-EURO-Meets-NeurIPS-2022-Competition)" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Let‚Äôs also try an instance based on real data, which uses an actual over-the-road distance matrix (non-Euclidean) and atypical client distribution. Note that the file is in VRPLIB format and the distances are already integral and so there is no rounding.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">name_ortec</span> <span class="o">=</span> <span class="s2">&quot;ORTEC-VRPTW-ASYM-0bdff870-d1-n458-k35&quot;</span>
<span class="n">instance_ortec</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data/</span><span class="si">{</span><span class="n">name_ortec</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
<span class="n">bks_ortec</span> <span class="o">=</span> <span class="n">vrplib</span><span class="o">.</span><span class="n">read_solution</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data/</span><span class="si">{</span><span class="n">name_ortec</span><span class="si">}</span><span class="s2">.sol&quot;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_instance</span><span class="p">(</span><span class="n">instance_ortec</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

<span class="n">result_ortec</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">instance_ortec</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_runtime</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">cost_evaluator</span> <span class="o">=</span> <span class="n">PenaltyManager</span><span class="p">()</span><span class="o">.</span><span class="n">get_cost_evaluator</span><span class="p">()</span>
<span class="n">best_cost_ortec</span> <span class="o">=</span> <span class="n">cost_evaluator</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">result_ortec</span><span class="o">.</span><span class="n">best</span><span class="p">)</span>
<span class="n">report_gap</span><span class="p">(</span><span class="n">best_cost_ortec</span><span class="p">,</span> <span class="n">bks_ortec</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot_result</span><span class="p">(</span><span class="n">result_ortec</span><span class="p">,</span> <span class="n">instance_ortec</span><span class="p">)</span>
<span class="n">plot_route_schedule</span><span class="p">(</span><span class="n">result_ortec</span><span class="p">,</span> <span class="n">instance_ortec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found a solution with cost: 259297.0.
This is 0.2% worse than the best known solution, which is 258704.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_vrptw_23_1.png" src="../_images/examples_vrptw_23_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_vrptw_23_2.png" src="../_images/examples_vrptw_23_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_vrptw_23_3.png" src="../_images/examples_vrptw_23_3.png" />
</div>
</div>
</section>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>In this notebook, we showed how to configure the Hybrid Genetic Search algorithm to solve the VRPTW. We run the solver on three different instances and we demonstrate how to use plotting and diagnostics utilities from the PyVRP library.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../setup/benchmarks.html" class="btn btn-neutral float-left" title="Benchmarks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cvrp.html" class="btn btn-neutral float-right" title="Capacitated Vehicle Routing Problem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 - 2023, PyVRP contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>